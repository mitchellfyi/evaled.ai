<% content_for :title, "Agent Router - Find the Best AI Agent | Evald.ai" %>
<% content_for :description, "Paste your prompt and find the best AI agent for the job. Intelligent prompt-to-agent matching powered by Evald's evaluation data." %>

<div class="max-w-3xl mx-auto">
  <!-- Header -->
  <div class="text-center mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Agent Router</h1>
    <p class="text-gray-600">Paste your prompt and we'll find the best agent for the job.</p>
  </div>

  <!-- Prompt Input -->
  <div class="bg-white rounded-xl shadow p-6 mb-8">
    <%= form_with url: router_path, method: :post, local: true do |f| %>
      <label for="prompt" class="block text-sm font-medium text-gray-700 mb-2">What do you want to do?</label>
      <textarea
        name="prompt"
        id="prompt"
        rows="4"
        class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-gray-900 p-3 border"
        placeholder="e.g. Write a Python script that parses CSV files and generates a summary report..."
      ><%= @prompt %></textarea>
      <div class="flex justify-end mt-4">
        <button type="submit" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition">
          Find Agent â†’
        </button>
      </div>
    <% end %>
  </div>

  <!-- Results -->
  <% if @results.present? %>
    <!-- Classification Info -->
    <div class="bg-gray-50 rounded-lg p-4 mb-6">
      <p class="text-sm text-gray-600">
        Classified as: 
        <span class="font-medium text-indigo-600"><%= @classification.category %></span>
        <% if @classification.subcategory %>
          / <span class="text-indigo-500"><%= @classification.subcategory %></span>
        <% end %>
        <span class="text-gray-400 ml-2">(<%= (@classification.confidence * 100).round %>% confidence)</span>
      </p>
    </div>

    <!-- Agent Matches -->
    <div class="space-y-4">
      <% medals = ["ðŸ¥‡", "ðŸ¥ˆ", "ðŸ¥‰"] %>
      <% @results.each_with_index do |match, index| %>
        <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="flex items-center space-x-2 mb-1">
                <span class="text-lg"><%= medals[index] || "â–ªï¸" %></span>
                <h3 class="text-lg font-bold text-gray-900"><%= match.agent.name %></h3>
                <% if match.agent.verified? %>
                  <span class="text-green-600 text-sm">âœ“ Verified</span>
                <% end %>
              </div>
              <% if match.agent.description.present? %>
                <p class="text-gray-600 text-sm mb-2"><%= match.agent.description.truncate(150) %></p>
              <% end %>
              <div class="flex flex-wrap gap-1 mb-2">
                <% match.reasons.each do |reason| %>
                  <span class="px-2 py-0.5 bg-indigo-50 text-indigo-700 rounded-full text-xs"><%= reason %></span>
                <% end %>
              </div>
            </div>
            <div class="text-right ml-4 shrink-0">
              <div class="text-2xl font-bold text-indigo-600"><%= match.score.round %>%</div>
              <div class="text-xs text-gray-400">match</div>
              <% if match.agent.decayed_score.present? %>
                <div class="text-sm text-gray-500 mt-1">Score: <%= match.agent.decayed_score.round %></div>
              <% end %>
            </div>
          </div>
          <div class="mt-3 pt-3 border-t border-gray-100">
            <%= link_to "View Profile â†’", agent_path(match.agent), class: "text-indigo-600 hover:text-indigo-700 text-sm font-medium" %>
          </div>
        </div>
      <% end %>
    </div>
  <% elsif @prompt.present? %>
    <!-- No Results -->
    <div class="bg-white rounded-xl shadow p-8 text-center">
      <p class="text-gray-500">No matching agents found. Try a different prompt or <%= link_to "browse all agents", agents_path, class: "text-indigo-600 hover:text-indigo-700" %>.</p>
    </div>
  <% end %>
</div>
