<% content_for :title, "AI Agent Evaluations - Evald.ai" %>
<% content_for :description, "Independently evaluated AI agents with trust scores. Compare agents for coding, research, workflow automation, and more — scored by Evald, not self-reported." %>

<div class="mb-8">
  <h1 class="text-3xl font-bold text-gray-900 mb-4">AI Agent Evaluations</h1>
  <p class="text-gray-600">Independently evaluated agents with verified trust scores. Filter by category or minimum score.</p>
</div>

<!-- Filters -->
<div class="flex flex-wrap gap-4 mb-8">
  <div class="flex items-center space-x-2">
    <span class="text-sm text-gray-500">Category:</span>
    <%= link_to "All", agents_path, class: "px-3 py-1 rounded-full text-sm #{params[:category].blank? ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}" %>
    <% @categories.each do |category| %>
      <%= link_to category.capitalize, agents_path(category: category, tag: params[:tag]), class: "px-3 py-1 rounded-full text-sm #{params[:category] == category ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}" %>
    <% end %>
  </div>
  
  <div class="flex items-center space-x-2">
    <span class="text-sm text-gray-500">Min Score:</span>
    <% [0, 60, 70, 80, 90].each do |score| %>
      <%= link_to score == 0 ? "Any" : "#{score}+", agents_path(category: params[:category], min_score: score == 0 ? nil : score, tag: params[:tag]), 
          class: "px-3 py-1 rounded-full text-sm #{params[:min_score].to_i == score || (score == 0 && params[:min_score].blank?) ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}" %>
    <% end %>
  </div>
</div>

<% if @tags.present? %>
<!-- Tag Filters -->
<div class="flex flex-wrap gap-2 mb-8">
  <span class="text-sm text-gray-500 py-1">Tags:</span>
  <% if @current_tag %>
    <%= link_to agents_path(category: params[:category], min_score: params[:min_score]), class: "px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200" do %>
      Clear filter ×
    <% end %>
  <% end %>
  <% @tags.each do |tag| %>
    <%= link_to agents_path(category: params[:category], min_score: params[:min_score], tag: tag.slug), 
        class: "px-3 py-1 rounded-full text-sm transition-colors",
        style: params[:tag] == tag.slug ? "background-color: #{tag.color}; color: white;" : "background-color: #{tag.color}20; color: #{tag.color};" do %>
      <%= tag.name %>
    <% end %>
  <% end %>
</div>
<% end %>

<!-- Featured Agents (only on first page) -->
<% if @featured_agents.present? && params[:category].blank? && params[:min_score].blank? && @page == 1 %>
<div class="mb-12">
  <h2 class="text-xl font-bold text-gray-900 mb-4">⭐ Featured Agents</h2>
  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
    <% @featured_agents.each do |agent| %>
      <%= render partial: 'card', locals: { agent: agent } %>
    <% end %>
  </div>
</div>
<% end %>

<!-- All Agents -->
<div>
  <h2 class="text-xl font-bold text-gray-900 mb-4">
    <%= params[:category].present? ? "#{params[:category].capitalize} Agents" : "All Agents" %>
    <span class="text-gray-400 font-normal">(<%= @total_count %>)</span>
  </h2>
  
  <% if @agents.empty? %>
    <div class="text-center py-12 bg-white rounded-xl">
      <p class="text-gray-500">No agents found matching your criteria.</p>
      <%= link_to "Clear filters", agents_path, class: "text-indigo-600 hover:text-indigo-700" %>
    </div>
  <% else %>
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      <% @agents.each do |agent| %>
        <%= render partial: 'card', locals: { agent: agent } %>
      <% end %>
    </div>
    
    <!-- Pagination -->
    <% if @total_pages > 1 %>
      <div class="mt-8 flex justify-center">
        <nav class="flex items-center space-x-1" aria-label="Pagination">
          <% if @page > 1 %>
            <%= link_to agents_path(page: @page - 1, category: params[:category], min_score: params[:min_score]), 
                class: "px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50" do %>
              ← Previous
            <% end %>
          <% end %>
          
          <span class="px-4 py-2 text-sm text-gray-700">
            Page <%= @page %> of <%= @total_pages %>
          </span>
          
          <% if @page < @total_pages %>
            <%= link_to agents_path(page: @page + 1, category: params[:category], min_score: params[:min_score]), 
                class: "px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50" do %>
              Next →
            <% end %>
          <% end %>
        </nav>
      </div>
    <% end %>
  <% end %>
</div>
